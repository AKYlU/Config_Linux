lsblk
cfdisk /dev/nvme0n1 

mkfs.vfat -F32 /dev/nvme0n1p1
mkfs.vfat -F32 /dev/nvme0n1p2
mkfs.btrfs /dev/nvme0n1p3

mkdir -p /boot
mount /dev/nvme0n1p2 /boot

mkdir -p /efi
mount /dev/nvme0n1p1 /efi

mkdir -p /mnt/gentoo
mount /dev/nvme0n1p3 /mnt/gentoo

mkdir -p /mnt/gentoo/boot
mount /dev/nvme0n1p1 /mnt/gentoo/boot

mkdir -p /mnt/gentoo/boot/efi
mount /dev/nvme0n1p2 /mnt/gentoo/boot/efi

cd /mnt/gentoo
wget https://distfiles.gentoo.org/releases/amd64/autobuilds/20241020T170324Z/stage3-amd64-desktop-openrc-20241020T170324Z.tar.xz
tar xpf stage3-amd64-desktop-openrc-20241020T170324Z.tar.xz 

mount --types proc /proc /mnt/gentoo/proc
mount --rbind /sys /mnt/gentoo/sys
mount --make-rslave /mnt/gentoo/sys
mount --rbind /dev /mnt/gentoo/dev
mount --make-rslave /mnt/gentoo/dev
mount --bind /run /mnt/gentoo/run
mount --make-slave /mnt/gentoo/run
cp /etc/resolv.conf etc && chroot . /bin/bash 
source /etc/profile

emerge-webrsync
passwd
useradd -g users -G wheel,portage,audio,video,usb,cdrom -m akil
passwd akil
emerge -vq vim

vim /etc/fstab
nvme0n1p1     /efi        vfat    defaults,noatime    1 2
nvme0n1p3     /           btrfs   noatime             0 1
/dev/cdrom    /mnt/cdrom  auto    noauto,ro           0 0

PARTLABEL=ESP     /efi        vfat    noauto,noatime    1 2
PARTLABEL=Root    /           btrfs    noatime          0 1
/dev/cdrom        /mnt/cdrom  auto    noauto,ro         0 0

vim /etc/portage/make.conf
# Estas configurações foram definidas pelo script Catalyst que construiu este stage.
COMMON_FLAGS="-O2 -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"

# Esta stage foi construída com a flag bindist habilitada.
USE="dist-kernel"

# Esta configuração define o idioma do output do build para inglês.
LC_MESSAGES=C.utf8

echo 'GRUB_PLATFORMS="efi-64"' >> /etc/portage/make.conf
emerge --ask sys-boot/grub
grub-install --efi-directory=/efi
grub-mkconfig -o /boot/grub/grub.cfg

emerge --ask net-misc/dhcpcd
rc-update add dhcpcd default
rc-service dhcpcd start

exit 
umount -R /mnt/gentoo
reboot
