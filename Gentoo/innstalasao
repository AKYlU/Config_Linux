# ver o Disco
lsblk
cfdisk /dev/nvme0n1 

# formato 
mkfs.vfat -F32 /dev/nvme0n1p1
mkfs.vfat -F32 /dev/nvme0n1p2
mkfs.btrfs /dev/nvme0n1p3

# cria arquivo
mkdir -p /mnt/gentoo/
mount /dev/nvme0n1p3 /mnt/gentoo
mkdir -p /mnt/gentoo/efi
mount /dev/nvme0n1p1 /mnt/gentoo/efi

chronyd -q

cd /mnt/gentoo

wget https://distfiles.gentoo.org/releases/amd64/autobuilds/current-stage3-amd64-openrc/stage3-amd64-openrc-XXXXXXXXXXXXXXX.tar.xz

tar xpvf

cp -L /etc/resolv.conf etc && arch-chroot .

emerge-webrsync 

emerge sys-boot/efibootmgr
rc-update add kernel-bootcfg-boot-successful default
cp arch/x86/boot/bzImage /efi/EFI/example/bzImage.efi
efibootmgr --create --disk /dev/nvme0n1p3 --label "Gentoo EFI Stub" --loader "\EFI\example\bzImage.efi" -u "root=/dev/nvme0n1p3"

emerge --ask app-portage/cpuid2cpuflags 

cpuid2cpuflags 

echo "*/* $(cpuid2cpuflags)" > /etc/portage/package.use/00cpu-flags 

emerge -avuDN @world

passwd

useradd -g users -G wheel,portage,audio,video,usb,cdrom -m akil

passwd akil

ln -sf /usr/share/zoneinfo/Europe/Helsinki /etc/localtime

nano /etc/portage/make.conf
USE="dist-kernel"

mkdir -p /etc/portage/package.license 
echo "sys-kernel/linux-firmware linux-fw-redistributable" >> /etc/portage/package.license/linux-firmware 
dispatch-conf
emerge --ask sys-kernel/linux-firmware

kernel
echo "sys-kernel/installkernel dracut" >> /etc/portage/package.use/installkernel 
emerge --ask sys-kernel/installkernel sys-kernel/gentoo-kernel-bin

etc-update

cd /usr/src/
wget kernel

emerge --ask sys-devel/llvm sys-devel/clang

export CC=clang
export LD=ld.lld
export AR=llvm-ar
export NM=llvm-nm
export OBJCOPY=llvm-objcopy
export OBJDUMP=llvm-objdump
export STRIP=llvm-strip


# moutar paticsao?
mount /dev/nvme0n1p2 /boot
mount /dev/nvme0n1p1 /efi
mount /dev/nvme0n1p3 /mnt/gentoo
mount /dev/nvme0n1p1 /mnt/gentoo/boot
mount /dev/nvme0n1p2 /mnt/gentoo/boot/efi

echo "sys-kernel/installkernel dracut" >> /etc/portage/package.use/installkernel 
emerge --ask sys-kernel/installkernel sys-kernel/gentoo-kernel-bin

#net
rc-update add dhcpcd default
rc-service dhcpcd start

nano /etc/portage/package.use/sysklogd
emerge --ask app-admin/sysklogd 
rc-update add sysklogd default 
rc-update add cronie default

exit 
reboot


